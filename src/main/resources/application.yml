server:
  port: ${PORT:8085}
  shutdown: graceful

spring:
  application:
    name: trade-commodity-codes
  datasource:
    url: jdbc:postgresql://${POSTGRES_WRITE_HOSTNAME:postgres}:5432/trade-commodity-codes
    hostname: ${POSTGRES_WRITE_HOSTNAME:postgres}
    port: 5432
    username: trade_commodity_codes
    database: trade_commodity_codes
    driver-class-name: org.postgresql.Driver
    ssl:
      enabled: true
    hikari:
      maximum-pool-size: ${POSTGRES_MAX_POOL_SIZE:10}
      minimum-idle: ${POSTGRES_MIN_IDLE:2}
      max-lifetime: ${POSTGRES_MAX_LIFETIME:600000}
      connection-timeout: ${POSTGRES_CONNECTION_TIMEOUT:30000}
      connection-test-query: SELECT 1
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:none}
    show-sql: ${JPA_SHOW_SQL:false}
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  lifecycle:
    timeout-per-shutdown-phase: 30s
  cloud:
    aws:
      cloudwatch:
        endpoint: ${AWS_EMF_AGENT_ENDPOINT:http://localhost:4566}
        region: ${AWS_REGION:eu-west-2}

# CDP platform configuration
cdp:
  certificate: ${TRUSTSTORE_CDP_ROOT_CA:}
  metrics:
    enabled: true
  service-version: ${SERVICE_VERSION:0.0.0-local}
  tracing:
    header-name: ${TRACING_HEADER:x-cdp-request-id}
  proxyUrl:

# AWS configuration
aws:
  rds:
    certificate: ${TRUSTSTORE_RDS_ROOT_CA:}
    iam:
      enabled: true
  region: ${AWS_REGION:eu-west-2}
  emf:
    enabled: ${AWS_EMF_ENABLED:true}
    environment: ${AWS_EMF_ENVIRONMENT:Local}
    namespace: ${AWS_EMF_NAMESPACE:trade-commodity-codes}
    service:
      name: ${AWS_EMF_SERVICE_NAME:trade-commodity-codes}
      type: ${AWS_EMF_SERVICE_TYPE:SpringBootApp}

# Logging configuration
logging:
  level:
    root: ${LOG_LEVEL:INFO}
    uk.gov.defra.cdp.trade.demo: ${LOG_LEVEL:DEBUG}
    uk.gov.defra.cdp.trade.demo.common.metrics: ${LOGGING_LEVEL_UK_GOV_DEFRA_CDP_TRADE_DEMO_COMMON_METRICS:INFO}
    org.springframework: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK:INFO}
    org.springframework.web: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB:INFO}
    org.mongodb: ${LOGGING_LEVEL_ORG_MONGODB_DRIVER:WARN}
    io.netty.handler.logging.LoggingHandler: WARN

# Actuator endpoints
# Production: Only health endpoint exposed (secure by default)
# Development: Use dev profile (application-local.yml) for debugging endpoints
management:
  endpoints:
    web:
      base-path: /
      exposure:
        include: health,metrics,info
  endpoint:
    health:
      show-details: never
  info:
    env:
      enabled: true
  health:
    mongo:
      enabled: false
  metrics:
    enabled: true
    export:
      cloudwatch:
        enabled: true
        step: 1m
        connectTimeout: 20s
        readTimeout: 20s
        batchSize: 1000
        numThreads: 2
  
# Application info (exposed via /info endpoint)
info:
  app:
    name: ${spring.application.name}
    version: ${cdp.service-version}
    environment: ${ENVIRONMENT:local}
